# Imports the Google Cloud client library
from google.cloud import language
from google.cloud.language import enums
from google.cloud.language import types
from aylienapiclient import textapi
import json


# # Instantiates a client
# client = language.LanguageServiceClient()

# # The text to analyze
# text = u'Hello, world!'
# document = types.Document(
#     content=text,
#     type=enums.Document.Type.PLAIN_TEXT)

# # Detects the sentiment of the text
# sentiment = client.analyze_sentiment(document=document).document_sentiment

# print('Text: {}'.format(text))
# print('Sentiment: {}, {}'.format(sentiment.score, sentiment.magnitude))

"""Detects entities in the text."""
client = language.LanguageServiceClient()

sumClient = textapi.Client("f6d9958d", "0814f897ec695d115d91055bb53d7cfa")

#textString = 'At a time when European kingdoms were beginning to establish new trade routes and colonies, motivated by imperialism and economic competition, Columbus proposed to reach the East Indies (South and Southeast Asia) by sailing westward. This eventually received the support of the Spanish Crown, which saw a chance to enter the spice trade with Asia through this new route. During his first voyage in 1492, he reached the New World instead of arriving in Japan as he had intended, landing on an island in the Bahamas archipelago that he named San Salvador. Over the course of three more voyages, he visited the Greater and Lesser Antilles, as well as the Caribbean coast of Venezuela and Central America, claiming all of it for the Crown of Castile. Though preceded by short-lived Norse colonization of North America led by Leif Erikson in the 11th century,[5][6] Columbus is the European explorer credited with establishing and documenting routes to the Americas, securing lasting European ties to the Americas, and inaugurating a period of exploration, conquest, and colonization that lasted for centuries. His exertions thereby strongly contributed to the development of the modern Western world. He also founded the transatlantic slave trade and has been accused by several historians of initiating the genocide of the Hispaniola natives. Columbus himself saw his accomplishments primarily in the light of spreading the Catholic religion.[7] Columbus had set course in hopes of finding a western route to the Indies (Asia). He called the inhabitants of the lands that he visited indios Spanish for Indians. His strained relationship with the Spanish crown and its appointed colonial administrators in America led to his arrest and dismissal as governor of the settlements on the island of Hispaniola in 1500, and later to protracted litigation over the benefits that he and his heirs claimed were owed to them by the crown.'
textString = 'A few years ago, some friends and I reserved a room at a Korean karaoke bar the night before my roommate, whom I’ll call Greg, was moving away from New York City. We had no intention of singing. We just wanted a private, soundproofed space with a microphone and free-flowing beer. We were there to roast Greg. One by one, each of us stood up in front of the neon-lit room and aimed our snark and indignities, normally spread scattershot among one another, squarely at our friend. Stupid facial hair. Fat. Questionable choices in women and in life. (He was going to graduate school for musical performance.) Even if the wit wasn’t there — and it wasn’t, for some roasts — the truth usually was. The roasts were intimate and cut deep because we all knew the stories behind them. Greg then roasted each one of us in turn. Everyone was blind drunk. Everyone had fun. Jeffrey Ross, the master of the Comedy Central roast, said a roast is “a sign of affection, truly. It’s a true test of love and friendship: Can you make a man laugh at himself?” The people you roast, he said, are those you “love and respect.” I thought Ross was right, at least with in-person roasts between friends, or even short-lived topical roasts in long-standing group chats. But we live in an age when social-media-enabled abuse is problematically rampant, when cyberbullying has gone wild. So how is it possible that r/RoastMe — a subreddit where people submit pictures of themselves to be roasted by faceless strangers on the internet — is thriving, to the tune of three-quarters of a million readers? The way Roast Me works is simple. You post a clear picture of yourself — no silly Snapchat filters, no overwrought Photoshop jobs — holding a handwritten sign that reads, “r/RoastMe.” Once a moderator approves your picture, it appears on the subreddit along with a post title you’ve written, something like “26, writer, stereotypical Brooklyn hipster, on multiple antidepressants. Roast me, dickwads.” Redditors then crack jokes at your expense, all in the name of comedy. For passive observers like myself, the appeal of Roast Me lies in redditors’ hilarious, witty insults. Puns! Cultural references! Savage one-line put-downs that spark dozens of “It’s over, you won the thread” comments! For roasters, surely it’s fun to be able to insult someone without repercussion. Plus, there’s a direct relationship between cruelly creative insults and upvote-induced validation. Since the subreddit’s hilarity is contingent not on the roastee’s post itself but on the comments it receives, each roaster is a de-facto content creator. Roast Me is crowdsourced comedy. It was hard for me to imagine, however, why anyone would willingly be roasted. Wouldn’t the way the world views you be brought into question if total strangers hit you over and over with the same spot-on roasts? Even a series of unserious roasts, I thought, could send someone into a black hole of serious, and seriously negative, introspection. One redditor described Roast Me as “consensual cyberbullying.” Another called it “digital BDSM,” hinting at the pain–pleasure relationship inherent in a roast. Nearly every roastee I spoke to said that actually feeling emotionally wounded or offended would be at odds with Roast Me’s guiding principle. “This is a comedy subreddit, not a hate subreddit,” reads the first rule for roasters in the community’s sidebar. “Act as though you are trying to make an audience laugh.” The unspoken corollary for roastees, then, is: “Don’t take this too seriously.” According to Abby, a 37-year-old roastee from Maine, the point of Roast Me “is to be clever and have fun with it.” She added, “I love to see high-quality, intelligent jokes made by people who are having fun and putting some effort in.” Regarding roastees, she said, “I like to think that most people are there by their own choice and can step away if they feel hurt by the comments.” Mike, a 32-year-old Canadian roastee, said, “People love the attention, and other people love to attack them anonymously from behind a keyboard.” Emily, a 21-year-old Texan, said of being roasted, “Some people were mean, which isn’t the point of the subreddit.” A roast can be cruel, in other words, and the best ones often are, but they must also be funny, or at least nod in that direction. Alex, a 17-year-old roastee from Michigan, told me, “You’ve gotta go in thinking it’s all in good fun. Otherwise, you’re not gonna have a good time.” He added, “Honestly, everybody should do it. It’s hilarious.” A pause. “As long as you go into it with the right mindset.” The “right mindset” for roastees, it would seem, means having thick skin and staying good-natured about the whole thing. But how do these people decide they want to be roasted in the first place? Given the large number of minor celebrities and internet personalities who’ve been roasted, it’s clear that Roast Me can be an outlet for masochistic self-promotion. Ken Bone, for example, the red-sweatered man who was virally meme-ified after asking a question at the second presidential debate in 2016, posted on Roast Me that November. In his picture, three clocks are visible on the wall behind him; his sign reads, “Come on, show me what you got.” What Ken got is Boned. The comments, more than 2,500 in all, were overwhelmingly critical of Bone’s futile attempt to prolong his fast-dimming starlight. One roaster asked, “Do you really need three clocks to let you know your fifteen minutes are up?” Other semi-famous personalities like the morally vacuous Logan Paul have posted on Roast Me, with most roasts falling along similar you’re-irrelevant-and-will-soon-be-forgotten lines. One redditor said they began writing a roast for Jake Paul, Logan’s brother and former Vine (RIP) star, before realizing it was Logan: “This is how interchangeable you two are to someone who doesn’t give two shits about your play-pretend internet fights.” Another redditor’s paragraph-length roast of Keemstar, a YouTuber with nearly 4 million subscribers, included lines like this one, both stone-cold cruel and orthodox for the subreddit: “Maybe it’s your hubris and fame-mongering that leaves you to continually scrape and claw at your own venomous, vapid relevance, knowing more than anyone that your clock is ticking, both as someone in your career field as well as a father.” As for why average-Joe non-celebrities, people who wouldn’t indirectly profit from being roasted, would hurl themselves into Roast Me’s void, one redditor stated the obvious: “It’s nice to laugh at yourself every once in a while.” Other roastees are driven by mere curiosity. Marie-Ève, an 18-year-old from Montreal, told me, “I was simply very curious to know what people would have to say about me. In real life, people never say what they truly think, if it’s negative.” Devlin, a 27-year-old from Chicago, thought the jokes would inform his standup comedy, but also thought, “What’s the worst anyone can say? How creative can [they] be?” Emily said that she’d always asked her friends to playfully roast her, but they never did. She knew Reddit would. The narcissism aspect — the fact that being roasted momentarily trains the spotlight of a corner of the internet onto you and only you — also draws people to the subreddit. Mike wanted to be roasted, he said, “to be the center of attention, to show myself that my skin was thick enough to handle criticism, and to make a few people laugh.” “You don’t have to be a celebrity or anybody,” Edward, a 21-year-old from Michigan who goes by SwagmasterEDP on Reddit, told me. “You just post your picture and there are going to be hundreds of people who look at you and pay you the time of day and then just give you direct attention.” He would know. In April 2015, prompted by a friend proudly posting a picture of his duct-tape prom outfit only to be disparaged by dozens of redditors, Edward created r/RoastMe. While he and his friends initially acted as moderators, a labor of love that required approving each and every submission, the subreddit grew so quickly that he soon handed over the reins of responsibility to another redditor, who has since handed them to someone else. Roast Me now has 10 moderators (and a bot) who approve a half-dozen submissions every hour — new people climbing straight into the dark, gaping maw of the internet monster. Its readership puts it just outside the top 100 subreddits, right behind r/Bitcoin, r/NFL, and r/RickAndMorty, the prevailing interests of young men on the internet, in a nutshell. Over half of redditors are between 18 and 29, nearly three-quarters are male, and two-thirds are white. Given that unoppressed demographic’s predominance, it should come as no surprise that Roast Me often turns freely and unabashedly racist, sexist, ableist, xenophobic, homophobic, and more. For black roastees, most roasts, including those in “Dark Meat,” one of Roast Me’s themed highlights albums, rely on age-old stereotypes: You’re poor, you don’t know who your father is, and you’ll probably either end up shot or in jail. For roastees who appear to be Muslim, the roasts are similarly predictable, revolving around terrorism and 9/11. Despite Reddit making headlines for being anti-women and fostering misogynistic Red Pill philosophy, and despite the fact that most women who post on Roast Me get ripped apart, submissions by women are relatively frequent. In a grown-up, 21st-century version of throwing sand at your biggest preschool crush, redditors are obsessed with the women of Roast Me. Beyond the celebrity and “celebrity” roasts, a majority of the subreddit’s all-time top submissions are by conventionally attractive young women, whom redditors berate for their beauty and creepily hit on in equal measure. (The most popular highlights album is “The Ladies of /r/RoastMe.”) I, like many others, first became aware of Roast Me when the roast of one such woman, a 27-year-old Houston-based model named Niece Waidhofer, went viral last year. Niece is the type of person whom redditors view with equal parts disdain, skepticism, and lecherousness: a stereotypically and self-awarely “hot” woman who puts concerted effort into her outward appearance with the purpose, at least in part, of growing her following on social media. Her Roast Me submission — ample cleavage, angular cheekbones, eyes haloed by a ring light made for selfies — had been Photoshopped, as numerous eagle-eyed redditors pointed out, to make her waist smaller and her bust larger. Her post title, “Fuck it,” reeked of someone indifferent to the community’s come-as-you-are ethos, of someone who believed she was above criticism. For Roast Me’s piranha-like men, all sharp-toothed and voracious and prone to predatory frenzy, Niece was bait. The roasts came fast and furious. Most were unimaginative variants of a tired trope: You’re an attention-whoring slut with daddy issues. One redditor called her an “entitled plastic whore,” writing, “Your push up bra could strangle the 3 children you abandoned and spent the child support to shoot heroin up with your junkie buddies and get new surgery on your already overdone and fake tits.” When Niece responded to “a handful of roasts that I felt didn’t make an attempt at humor,” a mild-mannered self-defense strategy, redditors smelled blood in the water. They attacked her for being an objectively attractive woman so insecure that she got “butthurt” by being called ugly and vapid. Some enterprising men dug through her Instagram for identifiable places, then shared what they thought to be her home address. Others sent her death and rape threats. Before long, Niece had deleted her Reddit account. She then posted on Instagram about her Roast Me experience, noting that a redditor masquerading as her ex-boyfriend under the username Neice_Ex_Throwaway — who’d made claims about her nipples, tattoos, and actress aspirations in a comment that was widely upvoted for its apparent believability — had spelled her name wrong. By then, Niece’s post had already skyrocketed up the Reddit ranks, cementing its place as the second most popular Roast Me thread of all time. A Roast Me moderator noted that the day of her roast was one of the subreddit’s highest-traffic days ever. Contrary to redditors’ beliefs, Niece wasn’t hoping to receive compliments. “There are plenty of other subreddits for that,” she wrote to me by email. “I knew people would be funny/mean, and I knew people would be mean/mean, but I did not expect people to dox me and threaten to burn my house down. I laugh about it now because it was probably just a bunch of hormonal, angry teenagers, but at the time it was pretty scary.” Still, she thought that “99 percent of the roasts were funny” and didn’t regret posting on Roast Me. The post’s virality, in fact, led to a huge increase in her Instagram following, and she now lives comfortably off the money she makes on the platform. I assumed the act of a woman deleting her account after posting on Roast Me — a knee-jerk response to falling into a nearly all-male echo chamber of verbal sludge — would be commonplace. It wasn’t. Despite the fact that nearly every Roast Me submission by women gets inundated with sexually charged comments of both the You’re a stupid cum dumpster and Please be my beautiful personal cum dumpster variety, the female roastees I spoke to told me they expected as much. Abby wasn’t “bothered or hurt at all,” adding that the mean-spirited comments were from “people [who] don’t get the point” of the subreddit. Emily told me, “I think I was an easy target because I’m a woman.” Nonetheless, she enjoyed reading the roasts, so much so that she’s told her friends to post their own photos. The only thing that upset her was when people roasted her boyfriend at the time. “That was uncalled for,” she said. “Everything else was fine.” With the self-post rule of consent ensuring that no one posts someone else’s picture in a less-graphic version of revenge porn, Roast Me’s baseline morality, much less legality, isn’t in question. “As long as you know everybody’s in agreement with what’s going on,” Edward said, “then you can really push the boundaries of what’s acceptable.” He likened Roast Me to a game of Airsoft or paintball, a recontextualizing of normally harmful instruments into a willingly participatory arena. Moderators have only had to remove a handful of roasts that were submitted on another person’s behalf and against their will. Still, the subreddit navigates moral gray areas. In trying to contact Roast Me’s moderators, I saw that my message’s subject line could be auto-filled using a drop-down menu of commonly abused rules, like “The Underage Rule,” “The Unfunny Abuse Rule,” “The Inappropriate Flattery Rule,” and, last on the list, “Threatening, harassing, or inciting violence.” Seeing these rules spelled out raised obvious questions. How are they enforced? What qualifies as “unfunny” (and, conversely, “funny”)? Who’s the arbiter of humor? These unanswerable queries reveal one of the subreddit’s most problematic aspects — not that most roasts are mean, but that they’re simply not funny. All humor is, of course, subjective. A roast that makes me guffaw might make you click the Report button without hesitation. But myriad “roasts” don’t even make a half-assed attempt at cleverness or wit. “Sometimes,” one Roast Me moderator wrote, “people don’t get the comedy part right and go straight for the throat, but we don’t encourage that.” In one roast thread of a transgender woman, for instance, a moderator’s sticked comment reads, “If you’re just slagging the fact [that] the roastee is MtF and there’s no attempt at humour, your comment is just going to get removed.” But Roast Me is so large and active a community that moderators can’t possibly stay ahead of the proliferation of pure insults. You ugly cunt. You fatass loser. The redditors behind those comments — and they are legion — are schoolyard bullies for the internet age, putting others down to make themselves feel better, to silence their internal cries of self-loathing. Helpfully and vulnerably, many roastees offer up insult fodder in their post titles, like World War I soldiers walking weaponless, hands raised, into no-man’s land. People reveal that they’re failing out of school, dying of cancer, or dealing with crippling alcoholism; they make sure the subreddit knows that their mom still buys them clothes, or their spouse cheated on them. Mike, who reveals that he’s a 32-year-old virgin in his post title, told me he wanted “to give [roasters] something to focus on, rather than just your appearance. It helps attract attention to your thread.” He doesn’t go around telling people in real life that he’s never had sex or has Asperger’s syndrome, he said, but thought that revealing such intimate personal details on the subreddit could aid the comedy of his roast. Alex, whose post title reads, “I chopped off the hair to blend in, still autistic, still have ADHD, wasn’t good enough to get drum major in my marching band. Make me cry,” told me that he was “just throwing people ammo.” Abby divulges that she’s a woman who “looks like a man and dresses like a child”; in her picture, she has a thinned-out mohawk and wears a jacket covered in ironic pins and patches, one of which says, “Yes, I am a model,” in all caps. “I think it was my way of pointing out the low-hanging fruit,” she said, ”and inviting the roasters to be more creative.” Devlin’s post title, meanwhile, is “Roast me worse than the chemo did (3x). Type 2 diabetic, heart failure.” He said that “just a picture doesn’t really tell much,” while a thorough post title “gives [roasters] background to add more content.” He’d been making cancer jokes among his friends since he was a kid, always turning to comedy to bring levity to his life. “The humor gives you a shield,” he told me. When I first learned of Roast Me, the pain of being a roastee was easy to imagine. I’m sensitive. Even my masochistic side doesn’t enjoy being insulted. I assumed that people who knew nothing about me would narrow in on the same surface-level qualities that were targets of middle school barbs: my skinniness, my Dumbo-like ears, my unruly mop of hair, and other traits that suggest, perhaps, that I’m a humongous virgin. Had waves of these insults crashed down on 16-year-old me, as virginal as the day is long, they would’ve knocked me flat. But when an actual 16-year-old girl, with short purple hair and a grim expression in her picture, logged on to Reddit, said she “hates life,” and asked to be roasted, something unexpected happened. “I just can’t,” a redditor wrote. “You are on the wrong [subreddit]. You need positive thoughts and feelings, and a way to get better.” Another wrote, “The hating life thing makes me want to hug you and invite you to fun events with my friends, not roast you.” One redditor suggested that moderators establish an “18+ rule” for Roast Me, writing, “This is just an excuse for people to bully an obese teenager. I’m not comfortable with this. This is a child.” Many redditors harped on the toxic combination of the internet’s brutality and a teenager’s malleable self-esteem. Some gave life advice — tips for weight loss, for managing depression, for leaving the past behind you. The thread’s most-upvoted comment reads like a self-help book: “You gotta dig down deep. … The sooner you start the better it will be, and it will get easier — fast.” Anywhere else on the internet, these comments would’ve felt cloyingly sincere. But in the context of Roast Me, I found them moving, so brazenly antithetical to the subreddit’s aim. (The roastee herself, however, might have felt differently. I sent her an interview request via private message on Reddit. She never responded. A couple weeks later, her account had been deleted.)'
#summary = client.Summarize({"text": "At a time when European kingdoms were beginning to establish new trade routes and colonies, motivated by imperialism and economic competition, Columbus proposed to reach the East Indies (South and Southeast Asia) by sailing westward. This eventually received the support of the Spanish Crown, which saw a chance to enter the spice trade with Asia through this new route. During his first voyage in 1492, he reached the New World instead of arriving in Japan as he had intended, landing on an island in the Bahamas archipelago that he named San Salvador. Over the course of three more voyages, he visited the Greater and Lesser Antilles, as well as the Caribbean coast of Venezuela and Central America, claiming all of it for the Crown of Castile. Though preceded by short-lived Norse colonization of North America led by Leif Erikson in the 11th century,[5][6] Columbus is the European explorer credited with establishing and documenting routes to the Americas, securing lasting European ties to the Americas, and inaugurating a period of exploration, conquest, and colonization that lasted for centuries. His exertions thereby strongly contributed to the development of the modern Western world. He also founded the transatlantic slave trade and has been accused by several historians of initiating the genocide of the Hispaniola natives. Columbus himself saw his accomplishments primarily in the light of spreading the Catholic religion.[7] Columbus had set course in hopes of finding a western route to the Indies (Asia). He called the inhabitants of the lands that he visited indios Spanish for Indians. His strained relationship with the Spanish crown and its appointed colonial administrators in America led to his arrest and dismissal as governor of the settlements on the island of Hispaniola in 1500, and later to protracted litigation over the benefits that he and his heirs claimed were owed to them by the crown."})
sentiment = sumClient.Summarize({'text': textString, 'title': 'Title', 'sentences_number': 10})

summary = "";

for element in sentiment['sentences']:
    # print (element + "\n")
    summary = summary + " " + element

text = summary

list1 = text.split('.')

# Instantiates a plain text document.
document = types.Document(
    content=text,
    type=enums.Document.Type.PLAIN_TEXT)

# Detects entities in the document. You can also analyze HTML with:
#   document.type == enums.Document.Type.HTML
entities = client.analyze_entities(document).entities

# entity types from enums.Entity.Type
entity_type = ('UNKNOWN', 'PERSON', 'LOCATION', 'ORGANIZATION',
                'EVENT', 'WORK_OF_ART', 'CONSUMER_GOOD', 'OTHER')

entries = sorted(entities, key=lambda entities: entities.salience, reverse=True)

questions = []
answers = []

for entity in entries:
    print('=' * 20)
    print(u'{:<16}: {}'.format('name', entity.name))
    print(u'{:<16}: {}'.format('type', entity_type[entity.type]))

print(summary)
print("\n\n")

for entity in entries:
    for s in list1:
        index = s.find(entity.name)
        if index != -1:
            questions.append(s[:index] + " ____ " + s[index + len(entity.name) + 1:])
            answers.append(entity.name)
            list1.remove(s)
            break
            
for i in range(len(questions)):
    print(str(i+1) + ". " + questions[i] + "\n Answer: " + answers[i] + "\n")

# for entity in entries:
#     print('=' * 20)
#     print(u'{:<16}: {}'.format('name', entity.name))
#     print(u'{:<16}: {}'.format('type', entity_type[entity.type]))
#     print(u'{:<16}: {}'.format('metadata', entity.metadata))
#     print(u'{:<16}: {}'.format('salience', entity.salience))